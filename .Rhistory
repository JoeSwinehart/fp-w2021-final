fnames <- fs::dir_ls(here::here("data"), type = "directory")
fnames
fpaths <- fs::dir_ls(here::here("data"), type = "directory")
str(fpaths)
?fs::dir_ls
qpaths <- fs::dir_ls(here::here("data", "questionnaire"), recurse = TRUE, glob = "*.csv")
qpaths <- fs::dir_ls(here::here("data"), recurse = TRUE, glob = "questionnaire.csv")
qpaths
qpaths <- fs::dir_ls(here::here("data"), recurse = TRUE)
qpaths
qpaths <- fs::dir_ls(here::here("data"),
recurse = TRUE,
regexp = "questionnaire.csv")
qpaths
dpaths <- fs::dir_ls(here::here("data"),
recurse = TRUE,
regexp = "demographic.csv")
demos <- map_df(qpaths, rio::import, .id = "fname")
View(demos)
parse_numer(demos$fname[1])
parse_number(demos$fname[1])
demos$fname[1]
parse_number(demos$fname[1])
?separate
demos <- map_df(qpaths, rio::import, .id = "fname") %>%
separate(col = fname, sep = "/")
demos <- map_df(qpaths, rio::import, .id = "fname") %>%
separate(col = fname, into = c(NA, NA, NA, NA, NA, "year", NA), sep = "/")
View(demos)
demos <- map_df(qpaths, rio::import, .id = "fname") %>%
separate(col = fname, into = c(NA, NA, NA, NA, NA, NA, "year", NA), sep = "/")
View(demos)
?parse_number
demos <- map_df(qpaths, rio::import, .id = "fname")
aa <- demos$fname[1]
aa
parse_numer(aa)
parse_number(aa)
extract_numeric(aa)
aa
parse_number(aa)
parse_number(aa)
gsub("([0-9]+).*$", "\\1", aa)
?gsub
grep("([0-9]+).*$", "\\1", aa)
str_extract(aa, pattern = [:digit:])
str_extract(aa, pattern = ":digit:")
str_extract(aa, pattern = "[:digit:]")
?str_extract
str_extract(aa, pattern = "[[:digit:]]")
str_extract_all(aa, pattern = "[[:digit:]]")
demos <- map_df(qpaths, rio::import, .id = "fname") %>%
separate(col = fname,
into = c(NA, NA, NA, NA, NA, NA,"year", NA),
sep = "/")
View(demos)
str_extract(aa, pattern = "\\d\\d\\d\\d_\\d\\d\\d\\d")
demos <- map_df(qpaths, rio::import, .id = "fname") %>%
mutate(year = str_extract(fname, pattern = "\\d\\d\\d\\d_\\d\\d\\d\\d"))
View(demos)
demos <- map_df(qpaths, rio::import, .id = "fname") %>%
mutate(year = str_extract(fname, pattern = "\\d\\d\\d\\d_\\d\\d\\d\\d")) %>%
select(-filename, year, everything())
View(demos)
demos <- map_df(qpaths, rio::import, .id = "fname") %>%
mutate(year = str_extract(fname, pattern = "\\d\\d\\d\\d_\\d\\d\\d\\d")) %>%
select(-fname) %>%
nest_by(year)
View(demos)
demos <- map_df(qpaths, rio::import, .id = "fname") %>%
mutate(year = str_extract(fname, pattern = "\\d{4}_\\d\\d\\d\\d")) %>%
select(-fname) %>%
nest_by(year)
View(demos)
demos <- map_df(qpaths, rio::import, .id = "fname") %>%
mutate(year = str_extract(fname, pattern = "\\d{4}_\\d{4}")) %>%
select(-fname) %>%
nest_by(year)
View(demos)
demos <- map_df(qpaths, rio::import, .id = "fname") %>%
mutate(year = str_extract(fname, pattern = "\\d{4}_\\d{4}")) %>%
select(-fname, year)
View(demos)
demos <- map_df(qpaths, rio::import, .id = "fname") %>%
mutate(year = str_extract(fname, pattern = "\\d{4}_\\d{4}")) %>%
select(-fname, year) %>%
nest_by(year)
demos <- map_df(qpaths, rio::import, .id = "fname") %>%
mutate(year = str_extract(fname, pattern = "\\d{4}_\\d{4}")) %>%
select(-fname, year, everything())
View(demos)
demos <- map_df(qpaths, rio::import, .id = "fname") %>%
mutate(year = str_extract(fname, pattern = "\\d{4}_\\d{4}")) %>%
select(year, everything(), -fname)
View(demos)
quests <- map_df(demos, rio::import, .id = "fname") %>%
mutate(year = str_extract(fname, pattern = "\\d{4}_\\d{4}")) %>%
select(year, everything(), -fname)
demos <- map_df(dpaths, rio::import, .id = "fname") %>%
mutate(year = str_extract(fname, pattern = "\\d{4}_\\d{4}")) %>%
select(year, everything(), -fname)
View(demos)
quests <- map_df(qpaths, rio::import, .id = "fname") %>%
mutate(year = str_extract(fname, pattern = "\\d{4}_\\d{4}")) %>%
select(year, everything(), -fname)
df <- left_join(demos, quests)
df <- left_join(demos, quests) %>%
nest_by(year)
df
aa <- df$year[[1]]
bb <- df$data[[1]]
?pivot_longer
bb %>%
pivot_longer(cols = c(PAQ677, PAQ678),
names_to = "exercise_type",
values_to = "num_days")
library(ggridges)
bb %>%
pivot_longer(cols = c(PAQ677, PAQ678),
names_to = "exercise_type",
values_to = "num_days") %>%
ggplot(aes(x = num_days, y = exercise_type, color = exercise_type)) +
geom_density_ridges()
bb %>%
pivot_longer(cols = c(PAQ677, PAQ678),
names_to = "exercise_type",
values_to = "num_days") %>%
ggplot(aes(x = num_days, y = exercise_type, color = exercise_type)) +
geom_density_ridges()
bb %>%
pivot_longer(cols = c(PAQ677, PAQ678),
names_to = "exercise_type",
values_to = "num_days") %>%
ggplot(aes(x = num_days, y = exercise_type, color = exercise_type)) +
geom_density_ridges()
bb <- bb %>%
pivot_longer(cols = c(PAQ677, PAQ678),
names_to = "exercise_type",
values_to = "num_days") %>%
ggplot(aes(x = num_days, y = exercise_type, color = exercise_type)) +
geom_density_ridges()
levels(bb$exercise_type)
levels(factor(bb$exercise_type))
bb <- bb %>%
pivot_longer(cols = c(PAQ677, PAQ678),
names_to = "exercise_type",
values_to = "num_days")
bb <- df$data[[1]]
bb <- bb %>%
pivot_longer(cols = c(PAQ677, PAQ678),
names_to = "exercise_type",
values_to = "num_days")
levels(factor(bb$exercise_type))
bb %>%
pivot_longer(cols = c(PAQ677, PAQ678),
names_to = "exercise_type",
values_to = "num_days")
bb <- df$data[[1]]
bb %>%
pivot_longer(cols = c(PAQ677, PAQ678),
names_to = "exercise_type",
values_to = "num_days") %>%
ggplot(aes(x = num_days, y = exercise_type, color = exercise_type)) +
geom_density_ridges()
knitr::opts_chunk$set(echo = FALSE)
library(tidyverse)
library(ggridges)
dpaths <- fs::dir_ls(here::here("data"),
recurse = TRUE,
regexp = "demographic.csv")
demos <- map_df(dpaths, rio::import, .id = "fname") %>%
mutate(year = str_extract(fname, pattern = "\\d{4}_\\d{4}")) %>%
select(year, everything(), -fname)
qpaths <- fs::dir_ls(here::here("data"),
recurse = TRUE,
regexp = "questionnaire.csv")
quests <- map_df(qpaths, rio::import, .id = "fname") %>%
mutate(year = str_extract(fname, pattern = "\\d{4}_\\d{4}")) %>%
select(year, everything(), -fname)
df <- left_join(demos, quests) %>%
nest_by(year)
bb %>%
pivot_longer(cols = c(PAQ677, PAQ678),
names_to = "exercise_type",
values_to = "num_days")
aa <- df$year[[1]]
bb <- df$data[[1]]
bb <- bb %>%
pivot_longer(cols = c(PAQ677, PAQ678),
names_to = "exercise_type",
values_to = "num_days")
View(bb)
sum(is.na(bb$num_days))
bb <- bb %>%
select(PAQ677, PAQ678)
bb <- df$data[[1]]
bb <- bb %>%
select(PAQ677, PAQ678)
View(bb)
bb <- df$data[[1]]
bb <- bb %>%
select(SEQN, year, PAQ677, PAQ678)
bb <- df$data[[1]]
bb <- bb %>%
select(SEQN, PAQ677, PAQ678) %>%
na.omit()
bb <- df$data[[1]]
bb <- bb %>%
select(SEQN, PAQ677, PAQ678)
sum(is.na(PAQ677))
sum(is.na(bb$PAQ677))
df
bb <- df$data[[3]]
bb <- bb %>%
select(SEQN, PAQ677, PAQ678)
sum(is.na(bb$PAQ677))
bb <- df$data[[2]]
bb <- bb %>%
select(SEQN, PAQ677, PAQ678)
sum(is.na(bb$PAQ677))
bb <- df$data[[4]]
bb <- bb %>%
select(SEQN, PAQ677, PAQ678)
sum(is.na(bb$PAQ677))
bb <- df$data[[5]]
bb <- bb %>%
select(SEQN, PAQ677, PAQ678)
sum(is.na(bb$PAQ677))
bb <- bb %>%
select(SEQN, PAQ677, PAQ678) %>%
na.omit() %>%
pivot_longer(cols = c(PAQ677, PAQ678),
names_to = "exercise_type",
values_to = "num_days") %>%
ggplot(aes(x = num_days, y = exercise_type, color = exercise_type)) +
geom_density_ridges()
bb %>%
select(SEQN, PAQ677, PAQ678) %>%
na.omit() %>%
pivot_longer(cols = c(PAQ677, PAQ678),
names_to = "exercise_type",
values_to = "num_days") %>%
ggplot(aes(x = num_days, y = exercise_type, color = exercise_type)) +
geom_density_ridges()
bb <- df$data[[3]]
bb %>%
select(SEQN, PAQ677, PAQ678) %>%
na.omit() %>%
pivot_longer(cols = c(PAQ677, PAQ678),
names_to = "exercise_type",
values_to = "num_days") %>%
ggplot(aes(x = num_days, y = exercise_type, color = exercise_type)) +
geom_density_ridges()
rm(list = ls())
dpaths <- fs::dir_ls(here::here("data"),
recurse = TRUE,
regexp = "demographic.csv")
demos <- map_df(dpaths, rio::import, .id = "fname") %>%
mutate(year = str_extract(fname, pattern = "\\d{4}_\\d{4}")) %>%
select(year, everything(), -fname)
qpaths <- fs::dir_ls(here::here("data"),
recurse = TRUE,
regexp = "questionnaire.csv")
quests <- map_df(qpaths, rio::import, .id = "fname") %>%
mutate(year = str_extract(fname, pattern = "\\d{4}_\\d{4}")) %>%
select(year, everything(), -fname)
demos$SEQN[1:100] == quests$SEQN[1:100]
df <- left_join(demos, quests) %>%
nest_by(year)
df
bb <- df$data[[4]]
sum(is.na(bb$PAQ677))
sum(is.na(bb$PAQ677=8))
sum(is.na(bb$PAQ678))
length(bb$PAQ678) - sum(is.na(bb$PAQ678))
length(bb$PAQ677) - sum(is.na(bb$PAQ677))
df
df
rm(list = ls())
library(distill)
getwd
getwd()
rename_post_dir("_posts/data-cleaning-and-purrr-or-shiny")
library(tidyverse)
datpath <- here::here("data")
fnames <- list.files(datpath)
pathnames <- str_c(datpath, fnames, sep = "/")
dfs <- map(pathnames, rio::import)
names(dfs) <- fnames
View(dfs)
View(dfs)
datpath <- here::here("data")
fnames <- list.files(datpath)
pathnames <- str_c(datpath, fnames, sep = "/")
fnames %>%
str_sub("DEMO")
fnames %>%
str_subset("DEMO")
rio::import(here::here("data",fnames[1]))
fnames <- list.files(here::here("data"))
fnames
fnames %>%
str_subset("DEMO")
demos <- fnames %>%
str_subset("DEMO")
demos <- fnames %>%
str_subset("DEMO") %>%
map_dfr(~{
rio::import(here::here("data", .x))
})
View(demos)
demos <- fnames %>%
str_subset("DEMO") %>%
map_dfr(~{
rio::import(here::here("data", .x))
}, .id = "filename")
View(demos)
library(fs)
dir_ls(here::here("data", "DEMO"))
dir_ls(here::here("data"))
dir_ls(here::here("data")) %>%
str_subset("DEMO")
dir_ls(here::here("data"), glob = "DEMO")
dir_ls(here::here("data"), glob = "*DEMO")
?dir_ls
dir_ls(here::here("data"), glob = "*DEMO*")
dir_ls(here::here("data"), "DEMO")
dir_ls(here::here("data"), regexp = "DEMO")
demos <- dir_ls(here::here("data"), regexp = "DEMO") %>%
map(rio::import)
fnames <- dir_ls(here::here("data"),
regexp = "DEMO")
fnames <-
demos <- dir_ls(here::here("data"),
regexp = "DEMO") %>%
map_dfr(rio::import, .id = "file")
demos <- dir_ls(here::here("data"),
regexp = "DEMO") %>%
map_dfr(rio::import, .id = "file")
View(demos)
aa <- demos$file[1]
aa
str_replace(aa, pattern = "\\d{4}_\\d{4}")
str_replace(aa, "\\d{4}_\\d{4}")
str_replace_all(aa, "\\d{4}_\\d{4}")
str_replace_all(aa, replacement = "\\d{4}_\\d{4}")
str_replace_all(aa, pattern = "\\d{4}_\\d{4}", "\\1")
str_replace(aa, pattern = "\\d{4}_\\d{4}", "\\1")
str_subset(aa, "\\d{4}_\\d{4}")
?str_replace_all
aa
str_subset(aa, pattern = "\\d{4}-\\d{4}")
?str_extract(aa, pattern = "\\d{4}-\\d{4}")
str_extract(aa, pattern = "\\d{4}-\\d{4}")
dir_ls(here::here("data"),
regexp = "DEMO") %>%
map_dfr(rio::import, .id = "file") %>%
mutate(year = str_extract(file, "\\d{4}_\\d{4}"))
demos <- dir_ls(here::here("data"),
regexp = "DEMO") %>%
map_dfr(rio::import, .id = "file") %>%
mutate(year = str_extract(file, "\\d{4}-\\d{4}"))
View(demos)
demos <- dir_ls(here::here("data"),
regexp = "DEMO") %>%
map_dfr(rio::import, .id = "file") %>%
mutate(year = str_extract(file, "\\d{4}-\\d{4}")) %>%
select(-file, year, SEQN,
RIAGENDR, RIDAGEYR, RIDRETH3,
DMDEDUC2, DMDEDUC3, INDHHIN2)
demos <- dir_ls(here::here("data"),
regexp = "DEMO") %>%
map_dfr(rio::import, .id = "file") %>%
mutate(year = str_extract(file, "\\d{4}-\\d{4}")) %>%
select(year, SEQN,
RIAGENDR, RIDAGEYR, RIDRETH3,
DMDEDUC2, DMDEDUC3, INDHHIN2)
View(demos)
demos <- dir_ls(here::here("data"),
regexp = "DEMO") %>%
map_dfr(rio::import, .id = "file") %>%
mutate(year = str_extract(file, "\\d{4}-\\d{4}")) %>%
select(year, SEQN,
RIAGENDR, RIDAGEYR, RIDRETH1,
DMDEDUC2, DMDEDUC3, INDHHIN2)
View(demos)
demos <- dir_ls(here::here("data"),
regexp = "DEMO") %>%
map_dfr(rio::import, .id = "file") %>%
mutate(year = str_extract(file, "\\d{4}-\\d{4}")) %>%
select(year, SEQN,
RIAGENDR, RIDAGEYR, RIDRETH1,
DMDEDUC2, DMDEDUC3, INDHHIN2, INDHHINC)
NA + 2
demos <- dir_ls(here::here("data"),
regexp = "DEMO") %>%
map_dfr(rio::import, .id = "file") %>%
mutate(year = str_extract(file, "\\d{4}-\\d{4}")) %>%
select(year, SEQN, RIDAGEYR, RIAGENDR,
RIDRETH1, DMDEDUC2, DMDEDUC3)
View(demos)
names(demos)[2:] <- c("id","age","gender","race_ethnicity","educ_adult","educ_child")
names(demos)[2:end] <- c("id","age","gender","race_ethnicity","educ_adult","educ_child")
names(demos) <- c("year", "id","age","gender","race_ethnicity","educ_adult","educ_child")
View(demos)
demos <- dir_ls(here::here("data"),
regexp = "DEMO") %>%
map_dfr(rio::import, .id = "file") %>%
mutate(year = str_extract(file, "\\d{4}-\\d{4}")) %>%
select(year, SEQN, RIDAGEYR, RIAGENDR,
RIDRETH1, DMDEDUC2, DMDEDUC3)
fsq <- dir_ls(here::here("data"),
regexp = "FSQ") %>%
map_dfr(rio::import, .id = "file") %>%
mutate(year = str_extract(file, "\\d{4}-\\d{4}")) %>%
select(year, SEQN, RIDAGEYR, RIAGENDR,
RIDRETH1, DMDEDUC2, DMDEDUC3)
fsq <- dir_ls(here::here("data"),
regexp = "FSQ") %>%
map_dfr(rio::import, .id = "file") %>%
mutate(year = str_extract(file, "\\d{4}-\\d{4}"))
View(fsq)
names(demos) <- c("year", "id","age","gender",
"race_ethnic","educ_adult","educ_child")
View(demos)
fsq <- dir_ls(here::here("data"),
regexp = "FSQ") %>%
map_dfr(rio::import, .id = "file") %>%
mutate(year = str_extract(file, "\\d{4}-\\d{4}"),
hh_food_secure = ifelse(year == ("1999-2000" | "2001-2002"),
HHfdec, FSDHH)) %>%
select(year, SEQN, hh_food_secure)
fsq <- dir_ls(here::here("data"),
regexp = "FSQ") %>%
map_dfr(rio::import, .id = "file") %>%
mutate(year = str_extract(file, "\\d{4}-\\d{4}"),
hh_food_secure = ifelse(year == "1999-2000" | year == "2001-2002",
HHfdec, FSDHH)) %>%
select(year, SEQN, hh_food_secure)
fsq <- dir_ls(here::here("data"),
regexp = "FSQ") %>%
map_dfr(rio::import, .id = "file") %>%
mutate(year = str_extract(file, "\\d{4}-\\d{4}"),
hh_food_secure = ifelse(year == "1999-2000" | year == "2001-2002",
HHfdsec, FSDHH)) %>%
select(year, SEQN, hh_food_secure)
View(fsq)
fsq <- dir_ls(here::here("data"),
regexp = "FSQ") %>%
map_dfr(rio::import, .id = "file") %>%
mutate(year = str_extract(file, "\\d{4}-\\d{4}"),
hh_food_secure = ifelse(year == "1999-2000" | year == "2001-2002",
HHFDSEC, FSDHH)) %>%
select(year, SEQN, hh_food_secure)
View(fsq)
names(fsq)[2] <- "id"
View(fsq)
df <- left_join(demos, fsq)
View(df)
rootpath <- here::here("data")
rootpath
demos <- dir_ls(rootpath,
regexp = "DEMO") %>%
map_dfr(rio::import, .id = "file") %>%
mutate(year = str_extract(file, "\\d{4}-\\d{4}")) %>%
select(year, SEQN, RIDAGEYR, RIAGENDR,
RIDRETH1, DMDEDUC2, DMDEDUC3)
names(demos) <- c("year", "id","age","gender",
"race_ethnic","educ_adult","educ_child")
fsq <- dir_ls(rootpath,
regexp = "FSQ") %>%
map_dfr(rio::import, .id = "file") %>%
mutate(year = str_extract(file, "\\d{4}-\\d{4}"),
hh_food_secure = ifelse(year == "1999-2000" | year == "2001-2002",
HHFDSEC, FSDHH)) %>%
select(year, SEQN, hh_food_secure)
names(fsq)[2] <- "id"
df <- left_join(demos, fsq)
rootpath
df %>% nest_by(year)
write_csv(df, str_c(rootpath,"/nhanes_1999-2016"))
write_csv(df, str_c(rootpath,"/nhanes_1999-2016.csv"))
library(distill)
rename_post_dir("_posts/data-cleaning-and-purrr-or-shiny/")
library(tidyverse)
library(tidyverse)
library(fs)
rootpath <- here::here("data")
demos <- dir_ls(rootpath,
regexp = "DEMO") %>%
map_dfr(rio::import, .id = "file") %>%
mutate(year = str_extract(file, "\\d{4}-\\d{4}")) %>%
select(year, SEQN, RIDAGEYR, RIAGENDR,
RIDRETH1, DMDEDUC2, DMDEDUC3)
demos <- dir_ls(rootpath,
regexp = "DEMO") %>%
map_dfr(rio::import, .id = "file") %>%
mutate(year = str_extract(file, "\\d{4}-\\d{4}")) %>%
select(year, SEQN, RIDAGEYR, RIAGENDR,
RIDRETH1, DMDEDUC2, DMDEDUC3)
names(demos) <- c("year", "id","age","gender",
"race_ethnic","educ_adult","educ_child")
fsq <- dir_ls(rootpath,
regexp = "FSQ") %>%
map_dfr(rio::import, .id = "file") %>%
mutate(year = str_extract(file, "\\d{4}-\\d{4}"),
hh_food_secure = ifelse(year == "1999-2000" | year == "2001-2002",
HHFDSEC, FSDHH)) %>%
select(year, SEQN, hh_food_secure)
names(fsq)[2] <- "id"
df <- left_join(demos, fsq)
write_csv(df, str_c(rootpath,"/nhanes_1999-2016.csv"))
